<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Vue Liste (Tree) des Clients -->
  <record id="view_saas_client_tree" model="ir.ui.view">
    <field name="name">saas.client.tree</field>
    <field name="model">saas.client</field>
    <field name="arch" type="xml">
      <tree string="Clients SaaS" decoration-success="state=='active'"
        decoration-muted="state in ('cancelled', 'suspended')">
        <field name="code" />
        <field name="name" />
        <field name="subdomain" />
        <field name="email" />
        <field name="plan_id" />
        <field name="state" widget="badge" decoration-success="state=='active'"
          decoration-info="state=='pending'" decoration-warning="state=='suspended'"
          decoration-danger="state=='cancelled'" />
        <field name="max_users" />
        <field name="current_users" />
        <field name="activation_date" />
      </tree>
    </field>
  </record>
  <!-- Vue Formulaire des Clients -->
  <record id="view_saas_client_form" model="ir.ui.view">
    <field name="name">saas.client.form</field>
    <field name="model">saas.client</field>
    <field name="arch" type="xml">
      <form string="Client SaaS">
        <header>
          <button name="action_activate" string="Activer" type="object" class="btn-primary"
            invisible="state == 'active'"
            confirm="ÃŠtes-vous sÃ»r de vouloir activer ce client ?" />
          <button name="action_suspend" string="Suspendre" type="object" class="btn-warning"
            invisible="state != 'active'"
            confirm="ÃŠtes-vous sÃ»r de vouloir suspendre ce client ?" />
          <button name="action_cancel" string="Annuler" type="object" class="btn-danger"
            invisible="state in ('cancelled', 'draft')"
            confirm="ÃŠtes-vous sÃ»r de vouloir annuler ce client ?" />
          <field name="state" widget="statusbar" statusbar_visible="draft,pending,active" />
        </header>
        <sheet>
          <div class="oe_button_box" name="button_box">
            <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
              <field name="active" widget="boolean_button" options='{"terminology": "archive"}' />
            </button>
          </div>
          <div class="oe_title">
            <h1>
              <field name="name" placeholder="Nom du client..." />
            </h1>
            <h2>
              <field name="code" readonly="1" />
            </h2>
          </div>
          <group>
            <group string="Informations Principales">
              <field name="email" widget="email" />
              <field name="phone" widget="phone" />
              <field name="subdomain" placeholder="mon-client" />
            </group>
            <group string="Abonnement">
              <field name="plan_id" options="{'no_create': True}" />
              <field name="activation_date" readonly="1" />
              <field name="expiration_date" />
            </group>
          </group>
          <group>
            <group string="Limites Utilisateurs">
              <field name="max_users" />
              <field name="current_users" />
            </group>
            <group string="Limites Stockage">
              <field name="max_storage_gb" widget="float" />
              <field name="current_storage_gb" widget="float" />
            </group>
          </group>
          <notebook>
            <page string="Notes" name="notes">
              <field name="notes" placeholder="Notes internes sur le client..." />
            </page>
          </notebook>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" />
          <field name="activity_ids" />
          <field name="message_ids" />
        </div>
      </form>
    </field>
  </record>
  <!-- Vue Kanban des Clients -->
  <record id="view_saas_client_kanban" model="ir.ui.view">
    <field name="name">saas.client.kanban</field>
    <field name="model">saas.client</field>
    <field name="arch" type="xml">
      <kanban class="o_kanban_mobile">
        <field name="id" />
        <field name="name" />
        <field name="code" />
        <field name="subdomain" />
        <field name="state" />
        <field name="plan_id" />
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
              <div class="oe_kanban_details">
                <div class="o_kanban_record_top">
                  <div class="o_kanban_record_headings">
                    <strong class="o_kanban_record_title">
                      <field name="name" />
                    </strong>
                    <br />
                    <span class="o_kanban_record_subtitle">
                      <field name="code" />
                    </span>
                  </div>
                  <span class="badge badge-pill"
                    t-attf-class="badge-{{record.state.raw_value == 'active' ? 'success' : 'secondary'}}">
                    <field name="state" />
                  </span>
                </div>
                <div class="o_kanban_record_body">
                  <field name="subdomain" />
                  <br />
                  <field name="plan_id" />
                </div>
                <div class="o_kanban_record_bottom">
                  <div class="oe_kanban_bottom_left">
                    <span>ğŸ‘¥ <field name="current_users" />/<field name="max_users" /></span>
                  </div>
                </div>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>
  <!-- Vue Recherche des Clients -->
  <record id="view_saas_client_search" model="ir.ui.view">
    <field name="name">saas.client.search</field>
    <field name="model">saas.client</field>
    <field name="arch" type="xml">
      <search string="Rechercher Clients">
        <field name="name" string="Client"
          filter_domain="['|', ('name', 'ilike', self), ('code', 'ilike', self)]" />
        <field name="subdomain" />
        <field name="email" />
        <field name="plan_id" />
        <separator />
        <filter string="Actifs" name="active" domain="[('state', '=', 'active')]" />
        <filter string="Brouillons" name="draft" domain="[('state', '=', 'draft')]" />
        <filter string="Suspendus" name="suspended" domain="[('state', '=', 'suspended')]" />
        <separator />
        <filter string="ArchivÃ©s" name="inactive" domain="[('active', '=', False)]" />
        <group expand="0" string="Grouper Par">
          <filter string="Ã‰tat" name="group_state" context="{'group_by': 'state'}" />
          <filter string="Plan" name="group_plan" context="{'group_by': 'plan_id'}" />
          <filter string="Date d'activation" name="group_activation_date"
            context="{'group_by': 'activation_date'}" />
        </group>
      </search>
    </field>
  </record>
  <!-- Action pour ouvrir les clients -->
  <record id="action_saas_client" model="ir.actions.act_window">
    <field name="name">Clients SaaS</field>
    <field name="res_model">saas.client</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="context">{'search_default_active': 1}</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        CrÃ©er votre premier client SaaS
      </p>
      <p>
        Cliquez sur "CrÃ©er" pour ajouter un nouveau client SaaS.
      </p>
    </field>
  </record>
</odoo>
