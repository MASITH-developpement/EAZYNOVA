<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Extension formulaire utilisateur -->
        <record id="view_users_form_eazynova" model="ir.ui.view">
            <field name="name">res.users.form.eazynova</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form"/>
            <field name="arch" type="xml">
                
                <!-- Ajout onglet Reconnaissance Faciale -->
                <xpath expr="//notebook" position="inside">
                    <page string="Reconnaissance Faciale" 
                          name="facial_recognition"
                          groups="group_eazynova_user">
                        
                        <group>
                            <group string="Configuration">
                                <field name="facial_recognition_enabled" 
                                       widget="boolean_toggle"/>
                                <field name="facial_consent_date" 
                                       readonly="1"
                                       invisible="not facial_recognition_enabled"/>
                                <field name="facial_last_update" 
                                       readonly="1"
                                       invisible="not facial_recognition_enabled"/>
                            </group>
                            
                            <group string="Données Biométriques">
                                <field name="facial_data" 
                                       invisible="1"/>
                                <div colspan="2" 
                                     invisible="facial_recognition_enabled">
                                    <div class="alert alert-info" role="alert">
                                        <i class="fa fa-info-circle"/> 
                                        La reconnaissance faciale n'est pas activée pour cet utilisateur.
                                    </div>
                                </div>
                                <div colspan="2" 
                                     invisible="not facial_recognition_enabled">
                                    <div class="alert alert-success" role="alert">
                                        <i class="fa fa-check-circle"/> 
                                        Reconnaissance faciale active
                                    </div>
                                </div>
                            </group>
                        </group>
                        
                        <!-- Actions -->
                        <group>
                            <group>
                                <button name="action_register_facial_data" 
                                        string="Enregistrer / Mettre à jour"
                                        type="object" 
                                        class="btn-primary"
                                        icon="fa-camera"
                                        help="Enregistrer ou mettre à jour vos données de reconnaissance faciale"/>
                            </group>
                            <group>
                                <button name="action_remove_facial_data" 
                                        string="Supprimer les données"
                                        type="object" 
                                        class="btn-danger"
                                        icon="fa-trash"
                                        confirm="Êtes-vous sûr de vouloir supprimer vos données de reconnaissance faciale ? Cette action est irréversible."
                                        invisible="not facial_recognition_enabled"/>
                            </group>
                        </group>
                        
                        <!-- Informations RGPD -->
                        <group string="Informations RGPD">
                            <div colspan="2" class="alert alert-warning">
                                <h4><i class="fa fa-shield"/> Protection des Données</h4>
                                <p>
                                    Conformément au RGPD, vos données biométriques sont :
                                </p>
                                <ul>
                                    <li>Stockées de manière chiffrée</li>
                                    <li>Utilisées uniquement pour l'authentification</li>
                                    <li>Non partagées avec des tiers</li>
                                    <li>Supprimables à tout moment</li>
                                </ul>
                                <p>
                                    <strong>Vos droits :</strong> Accès, Rectification, Effacement, 
                                    Opposition, Limitation, Portabilité
                                </p>
                            </div>
                        </group>
                        
                    </page>
                </xpath>
                
            </field>
        </record>
        
        <!-- Vue formulaire préférences utilisateur -->
        <record id="view_users_form_simple_modif_eazynova" model="ir.ui.view">
            <field name="name">res.users.form.simple.modif.eazynova</field>
            <field name="model">res.users</field>
            <field name="inherit_id" ref="base.view_users_form_simple_modif"/>
            <field name="arch" type="xml">
                
                <xpath expr="//sheet" position="inside">
                    <group string="EAZYNOVA" name="eazynova_preferences">
                        <field name="facial_recognition_enabled" 
                               widget="boolean_toggle"
                               string="Connexion par reconnaissance faciale"/>
                        <button name="action_register_facial_data" 
                                string="Configurer"
                                type="object" 
                                class="btn-sm btn-primary"
                                icon="fa-camera"
                                invisible="not facial_recognition_enabled"/>
                    </group>
                </xpath>
                
            </field>
        </record>
        
    </data>
</odoo>