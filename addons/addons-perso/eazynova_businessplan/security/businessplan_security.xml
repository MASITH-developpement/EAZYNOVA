<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <!-- Catégories de groupes -->
        <record id="module_category_businessplan" model="ir.module.category">
            <field name="name">Business Plan</field>
            <field name="description">Gestion des business plans et indicateurs</field>
            <field name="sequence">10</field>
        </record>

        <!-- Groupes d'utilisateurs -->
        <record id="group_businessplan_user" model="res.groups">
            <field name="name">Utilisateur Business Plan</field>
            <field name="category_id" ref="module_category_businessplan"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
            <field name="comment">L'utilisateur peut créer et gérer ses propres business plans</field>
        </record>

        <record id="group_businessplan_manager" model="res.groups">
            <field name="name">Manager Business Plan</field>
            <field name="category_id" ref="module_category_businessplan"/>
            <field name="implied_ids" eval="[(4, ref('group_businessplan_user'))]"/>
            <field name="comment">Le manager peut valider les business plans et gérer tous les business plans</field>
        </record>

        <!-- Règles d'accès aux données (Record Rules) -->

        <!-- Business Plan - Utilisateurs voient leurs propres BP -->
        <record id="business_plan_user_rule" model="ir.rule">
            <field name="name">Business Plan: utilisateur voit ses propres BP</field>
            <field name="model_id" ref="model_business_plan"/>
            <field name="domain_force">[('user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Business Plan - Managers voient tous les BP -->
        <record id="business_plan_manager_rule" model="ir.rule">
            <field name="name">Business Plan: manager voit tous les BP</field>
            <field name="model_id" ref="model_business_plan"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Indicateurs - Utilisateurs voient les indicateurs de leurs BP -->
        <record id="business_plan_indicator_user_rule" model="ir.rule">
            <field name="name">Indicateur: utilisateur voit ses propres indicateurs</field>
            <field name="model_id" ref="model_business_plan_indicator"/>
            <field name="domain_force">[('business_plan_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Indicateurs - Managers voient tous les indicateurs -->
        <record id="business_plan_indicator_manager_rule" model="ir.rule">
            <field name="name">Indicateur: manager voit tous les indicateurs</field>
            <field name="model_id" ref="model_business_plan_indicator"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Historique - Utilisateurs voient l'historique de leurs indicateurs -->
        <record id="business_plan_indicator_history_user_rule" model="ir.rule">
            <field name="name">Historique: utilisateur voit son propre historique</field>
            <field name="model_id" ref="model_business_plan_indicator_history"/>
            <field name="domain_force">[('indicator_id.business_plan_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Historique - Managers voient tout l'historique -->
        <record id="business_plan_indicator_history_manager_rule" model="ir.rule">
            <field name="name">Historique: manager voit tout l'historique</field>
            <field name="model_id" ref="model_business_plan_indicator_history"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_businessplan_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

    </data>
</odoo>
