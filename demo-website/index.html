<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EAZYNOVA - Votre Plateforme Odoo 19 en 5 Minutes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            margin-bottom: 30px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .feature {
            text-align: center;
            padding: 20px;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .feature h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #888;
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            display: none;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .result.loading {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            color: #1976d2;
        }

        .result.success {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            color: #2e7d32;
        }

        .result.error {
            background: #ffebee;
            border: 2px solid #f44336;
            color: #c62828;
        }

        .result h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .result p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .result strong {
            color: #333;
        }

        .result a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .result a:hover {
            text-decoration: underline;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .credentials {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .credentials p {
            font-family: 'Courier New', monospace;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
        }

        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.1);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            opacity: 0.8;
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-size: 14px;
            font-weight: 600;
        }

        .api-status.online {
            color: #4caf50;
        }

        .api-status.offline {
            color: #f44336;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .card {
                padding: 20px;
            }

            .features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="api-status" id="apiStatus">
        üî¥ API Non Connect√©e
    </div>

    <div class="container">
        <div class="header">
            <h1>üöÄ EAZYNOVA</h1>
            <p>Votre plateforme Odoo 19 personnalis√©e en 5 minutes</p>
        </div>

        <div class="card">
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Ultra Rapide</h3>
                    <p>D√©ploiement en 5-8 minutes</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üîí</div>
                    <h3>100% S√©curis√©</h3>
                    <p>HTTPS et isolation compl√®te</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üí∞</div>
                    <h3>Tout Inclus</h3>
                    <p>PostgreSQL + Odoo 19 configur√©</p>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="form-section">
                <h2>‚ú® Cr√©ez Votre Instance EAZYNOVA</h2>
                <form id="createInstanceForm">
                    <div class="form-group">
                        <label for="clientName">
                            üè¢ Nom de votre entreprise
                        </label>
                        <input
                            type="text"
                            id="clientName"
                            placeholder="ex: ma-societe"
                            required
                            pattern="[a-z0-9-]+"
                            title="Lettres minuscules, chiffres et tirets uniquement"
                        >
                        <small>Utilis√© pour cr√©er votre URL unique (lettres, chiffres, tirets)</small>
                    </div>

                    <div class="form-group">
                        <label for="adminEmail">
                            üìß Email administrateur
                        </label>
                        <input
                            type="email"
                            id="adminEmail"
                            placeholder="admin@votresociete.com"
                            required
                        >
                        <small>Pour vous connecter √† votre instance</small>
                    </div>

                    <div class="form-group">
                        <label for="companyName">
                            üè∑Ô∏è Nom complet de l'entreprise
                        </label>
                        <input
                            type="text"
                            id="companyName"
                            placeholder="Ma Soci√©t√© SARL"
                        >
                        <small>Optionnel - Affich√© dans votre instance Odoo</small>
                    </div>

                    <button type="submit" class="btn" id="submitBtn">
                        üöÄ Cr√©er Mon Instance Maintenant
                    </button>
                </form>

                <div id="result" class="result"></div>
            </div>
        </div>

        <div class="footer">
            <p>Powered by EAZYNOVA & Railway</p>
            <p>‚ú® D√©ploiement automatique - Aucune configuration manuelle ‚ú®</p>
        </div>
    </div>

    <script>
        // Configuration de l'API
        const API_URL = 'http://localhost:3000';

        // √âl√©ments DOM
        const form = document.getElementById('createInstanceForm');
        const resultDiv = document.getElementById('result');
        const submitBtn = document.getElementById('submitBtn');
        const apiStatus = document.getElementById('apiStatus');

        // V√©rifier le statut de l'API au d√©marrage
        checkAPIStatus();

        async function checkAPIStatus() {
            try {
                const response = await fetch(`${API_URL}/`);
                if (response.ok) {
                    apiStatus.textContent = 'üü¢ API Connect√©e';
                    apiStatus.className = 'api-status online';
                } else {
                    throw new Error('API non disponible');
                }
            } catch (error) {
                apiStatus.textContent = 'üî¥ API Non Connect√©e';
                apiStatus.className = 'api-status offline';
                console.error('API non disponible:', error);
            }
        }

        // Gestion de la soumission du formulaire
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const clientName = document.getElementById('clientName').value.trim();
            const adminEmail = document.getElementById('adminEmail').value.trim();
            const companyName = document.getElementById('companyName').value.trim() || clientName;

            // D√©sactiver le bouton
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Cr√©ation en cours...';

            // Afficher le chargement
            showLoading();

            try {
                // Appel √† l'API
                const response = await fetch(`${API_URL}/api/instances`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        clientName: clientName,
                        adminEmail: adminEmail,
                        companyName: companyName
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Succ√®s - Commencer le suivi
                    showCreating(data.instanceId, clientName);
                    monitorInstance(data.instanceId);
                } else {
                    // Erreur
                    showError(data.error || 'Une erreur est survenue');
                    resetButton();
                }
            } catch (error) {
                showError(`Impossible de contacter l'API: ${error.message}`);
                resetButton();
            }
        });

        function showLoading() {
            resultDiv.className = 'result loading';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="spinner"></div>
                <h3>‚è≥ Connexion √† l'API...</h3>
                <p>Veuillez patienter...</p>
            `;
        }

        function showCreating(instanceId, clientName) {
            resultDiv.className = 'result loading';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>üéâ Cr√©ation D√©marr√©e !</h3>
                <p><strong>Instance ID:</strong> ${instanceId}</p>
                <p><strong>Client:</strong> ${clientName}</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <p id="statusMessage">Initialisation...</p>
                <p><small>‚è±Ô∏è Temps estim√©: 5-8 minutes</small></p>
            `;
        }

        async function monitorInstance(instanceId) {
            const progressFill = document.getElementById('progressFill');
            const statusMessage = document.getElementById('statusMessage');
            let progress = 10;

            // Simuler la progression
            const progressInterval = setInterval(() => {
                if (progress < 90) {
                    progress += 2;
                    progressFill.style.width = progress + '%';
                    progressFill.textContent = progress + '%';
                }
            }, 3000);

            // V√©rifier le statut r√©el toutes les 10 secondes
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_URL}/api/instances/${instanceId}`);
                    const data = await response.json();

                    if (data.status === 'ready') {
                        clearInterval(progressInterval);
                        clearInterval(checkInterval);
                        showSuccess(data);
                    } else if (data.status === 'failed') {
                        clearInterval(progressInterval);
                        clearInterval(checkInterval);
                        showError(data.error || 'Le d√©ploiement a √©chou√©');
                        resetButton();
                    } else {
                        // Mise √† jour du message de statut
                        const messages = [
                            'üì¶ Cr√©ation du projet Railway...',
                            'üîó Connexion au repository GitHub...',
                            'üóÑÔ∏è D√©ploiement de PostgreSQL...',
                            'üê≥ Construction de l'image Odoo...',
                            '‚öôÔ∏è Configuration des variables...',
                            'üöÄ Lancement des services...',
                            '‚ú® Finalisation...'
                        ];
                        const messageIndex = Math.min(Math.floor(progress / 15), messages.length - 1);
                        statusMessage.textContent = messages[messageIndex];
                    }
                } catch (error) {
                    console.error('Erreur lors de la v√©rification du statut:', error);
                }
            }, 10000); // V√©rifier toutes les 10 secondes
        }

        function showSuccess(data) {
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <h3>üéâ Votre Instance EAZYNOVA est Pr√™te !</h3>
                <p>F√©licitations ! Votre plateforme Odoo 19 est op√©rationnelle.</p>

                <div class="credentials">
                    <h4>üîë Vos Identifiants de Connexion</h4>
                    <p><strong>URL :</strong> <a href="${data.instanceUrl}" target="_blank">${data.instanceUrl}</a></p>
                    <p><strong>Email :</strong> ${data.adminEmail}</p>
                    <p><strong>Mot de passe :</strong> ${data.adminPassword}</p>
                    <p><strong>Base de donn√©es :</strong> ${data.databaseName}</p>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <a href="${data.instanceUrl}" target="_blank" class="btn" style="display: inline-block; text-decoration: none; width: auto; padding: 15px 40px;">
                        üöÄ Acc√©der √† Mon Instance
                    </a>
                </div>

                <p style="margin-top: 20px; text-align: center;">
                    <small>üí° Conservez pr√©cieusement ces identifiants !</small>
                </p>
            `;

            // R√©initialiser le formulaire
            form.reset();
            resetButton();
        }

        function showError(message) {
            resultDiv.className = 'result error';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>‚ùå Erreur</h3>
                <p>${message}</p>
                <p><small>Veuillez v√©rifier que l'API est d√©marr√©e (node api-server.js)</small></p>
            `;
        }

        function resetButton() {
            submitBtn.disabled = false;
            submitBtn.textContent = 'üöÄ Cr√©er Mon Instance Maintenant';
        }

        // Rev√©rifier le statut de l'API toutes les 30 secondes
        setInterval(checkAPIStatus, 30000);
    </script>
</body>
</html>
